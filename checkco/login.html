<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Login - AI Assistant</title>
    <meta property="og:title" content="Login - AI Assistant" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta charset="utf-8" />
    <meta property="twitter:card" content="summary_large_image" />

    <style data-tag="reset-style-sheet">
      /* Reset styles */
      html {  line-height: 1.15;}body {  margin: 0;}* {  box-sizing: border-box;  border-width: 0;  border-style: solid;}p,li,ul,pre,div,h1,h2,h3,h4,h5,h6,figure,blockquote,figcaption {  margin: 0;  padding: 0;}button {  background-color: transparent;}button,input,optgroup,select,textarea {  font-family: inherit;  font-size: 100%;  line-height: 1.15;  margin: 0;}button,select {  text-transform: none;}button,[type="button"],[type="reset"],[type="submit"] {  -webkit-appearance: button;}button::-moz-focus-inner,[type="button"]::-moz-focus-inner,[type="reset"]::-moz-focus-inner,[type="submit"]::-moz-focus-inner {  border-style: none;  padding: 0;}button:-moz-focus,[type="button"]:-moz-focus,[type="reset"]:-moz-focus,[type="submit"]:-moz-focus {  outline: 1px dotted ButtonText;}a {  color: inherit;  text-decoration: inherit;}input {  padding: 2px 4px;}img {  display: block;}html { scroll-behavior: smooth  }
    </style>
    <style data-tag="default-style-sheet">
      html {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
        font-size: 16px;
      }

      body {
        font-weight: 400;
        font-style: normal;
        text-decoration: none;
        text-transform: none;
        letter-spacing: normal;
        line-height: 1.15;
        color: #333;
        background: #f5f5f5;
        margin: 0;
      }

      /* Header styles */
      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem 2rem;
        background-color: #fff;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      }

      .logo {
        height: 40px;
      }

      .header-right {
        display: flex;
        align-items: center;
      }

      .sign-in-button {
        background-color: #5128f5;
        color: white;
        padding: 8px 16px;
        border-radius: 5px;
        cursor: pointer;
        font-weight: bold;
        margin-left: 15px;
      }

      .user-info {
        display: none;
        align-items: center;
      }

      .user-avatar {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        background-color: #ccc;
        margin-right: 10px;
      }

      /* SSO Login Modal */
      .sso-modal {
        display: block;
        position: fixed;
        z-index: 1;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.4);
      }

      .sso-modal-content {
        background-color: #fefefe;
        margin: 15% auto;
        padding: 20px;
        border: 1px solid #888;
        width: 80%;
        max-width: 500px;
        border-radius: 10px;
      }

      .sso-buttons {
        display: flex;
        flex-direction: column;
        gap: 15px;
        margin-top: 20px;
      }

      .sso-button {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 12px;
        border-radius: 5px;
        cursor: pointer;
        font-weight: bold;
        border: 1px solid #ddd;
        background-color: #fff;
        transition: background-color 0.3s;
      }

      .sso-button:hover {
        background-color: #f5f5f5;
      }

      .sso-button img {
        width: 24px;
        height: 24px;
        margin-right: 10px;
      }

      .sso-divider {
        display: flex;
        align-items: center;
        margin: 20px 0;
      }

      .sso-divider::before, .sso-divider::after {
        content: "";
        flex: 1;
        border-bottom: 1px solid #ddd;
      }

      .sso-divider-text {
        padding: 0 10px;
        color: #777;
      }

      .traditional-login {
        margin-top: 20px;
      }

      .form-group {
        margin-bottom: 15px;
      }

      .form-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
      }

      .form-group input {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 5px;
      }

      .modal-buttons {
        display: flex;
        justify-content: flex-end;
        gap: 10px;
        margin-top: 20px;
      }

      .modal-button {
        padding: 10px 15px;
        border-radius: 5px;
        cursor: pointer;
        font-weight: bold;
      }

      .submit-button {
        background-color: #5128f5;
        color: white;
        border: none;
      }

      .submit-button:hover {
        background-color: #3a1fca;
      }

      .cancel-button {
        background-color: #f0f0f0;
        color: #333;
        border: 1px solid #ddd;
      }

      .cancel-button:hover {
        background-color: #e0e0e0;
      }

      .register-form {
        display: none;
      }

      /* Responsive design */
      @media (max-width: 768px) {
        .sso-modal-content {
          width: 90%;
          margin: 25% auto;
        }
      }
    </style>
  </head>

  <body>
    <!-- Header with logo -->
    <header class="header">
      <img src="public/pastedimage-no9b-1500h.png" alt="CheckCo Logo" class="logo">
    </header>

    <!-- Login Container (Always visible) -->
    <div id="login-container" class="sso-modal">
      <div class="sso-modal-content">
        <h2>Sign in to CheckCo</h2>
        <p>Choose your preferred sign in method below</p>
        
        <div class="sso-buttons">
          <button class="sso-button" id="google-sso">
            <img src="https://cdn-icons-png.flaticon.com/512/2991/2991148.png" alt="Google">
            Continue with Google
          </button>
          <button class="sso-button" id="microsoft-sso">
            <img src="https://cdn-icons-png.flaticon.com/512/732/732221.png" alt="Microsoft">
            Continue with Microsoft
          </button>
          <button class="sso-button" id="apple-sso">
            <img src="https://cdn-icons-png.flaticon.com/512/0/747.png" alt="Apple">
            Continue with Apple
          </button>
        </div>
        
        <div class="sso-divider">
          <span class="sso-divider-text">or</span>
        </div>
        
        <div class="traditional-login">
          <div class="form-group">
            <label for="email">Email</label>
            <input type="email" id="email" placeholder="Enter your email">
          </div>
          <div class="form-group">
            <label for="password">Password</label>
            <input type="password" id="password" placeholder="Enter your password">
          </div>
          <div class="modal-buttons">
            <button type="button" id="login-button" class="modal-button submit-button">Sign In</button>
          </div>
          <div class="register-link" style="margin-top: 10px; text-align: center;">
            <a href="#" id="show-register">Don't have an account? Register</a>
          </div>
        </div>
        <div class="register-form" id="register-form">
          <div class="form-group">
            <label for="register-name">Name</label>
            <input type="text" id="register-name" placeholder="Enter your name">
          </div>
          <div class="form-group">
            <label for="register-email">Email</label>
            <input type="email" id="register-email" placeholder="Enter your email">
          </div>
          <div class="form-group">
            <label for="register-password">Password</label>
            <input type="password" id="register-password" placeholder="Enter your password">
          </div>
          <div class="modal-buttons">
            <button type="button" id="back-to-login" class="modal-button cancel-button">Back to Login</button>
            <button type="button" id="register-button" class="modal-button submit-button">Register</button>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Handle SSO login (Google)
      document.getElementById('google-sso').addEventListener('click', async function() {
        console.log("Google SSO button clicked");
        try {
          console.log("Sending request to server...");
          const response = await fetch('http://localhost:8000/sso-login', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
              provider: 'Google',
              email: 'user@example.com'
            })
          });
          
          console.log("Server response status:", response.status);
          
          const data = await response.json();
          console.log("Server response data:", data);
          
          if (data.success) {
            console.log("Login successful, redirecting...");
            
            // Store user info in session storage
            sessionStorage.setItem('username', data.user.name);
            sessionStorage.setItem('userEmail', data.user.email);
            sessionStorage.setItem('isLoggedIn', 'true');
            
            // Redirect to API key page
            window.location.href = 'function_selection.html';
          } else {
            console.error("Login failed:", data.error);
            alert('SSO login failed: ' + data.error);
          }
        } catch (error) {
          console.error('Error during SSO login:', error);
          
          // For demo purposes: continue anyway with mock data
          sessionStorage.setItem('username', 'Demo User');
          sessionStorage.setItem('userEmail', 'demo@example.com');
          sessionStorage.setItem('isLoggedIn', 'true');
          
          // Redirect to API key page
          window.location.href = 'function_selection.html';
        }
      });
      
      // Handle SSO login (Microsoft)
      document.getElementById('microsoft-sso').addEventListener('click', async function() {
        try {
          const response = await fetch('http://localhost:8000/sso-login', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
              provider: 'Microsoft',
              email: 'user@example.com'
            })
          });
          
          const data = await response.json();
          
          if (data.success) {
            // Store user info in session storage
            sessionStorage.setItem('username', data.user.name);
            sessionStorage.setItem('userEmail', data.user.email);
            sessionStorage.setItem('isLoggedIn', 'true');
            
            // Redirect to API key page
            window.location.href = 'function_selection.html';
          } else {
            alert('SSO login failed: ' + data.error);
          }
        } catch (error) {
          console.error('Error during SSO login:', error);
          
          // For demo purposes: continue anyway with mock data
          sessionStorage.setItem('username', 'Demo User');
          sessionStorage.setItem('userEmail', 'demo@example.com');
          sessionStorage.setItem('isLoggedIn', 'true');
          
          // Redirect to API key page
          window.location.href = 'function_selection.html';
        }
      });

      // Handle SSO login (Apple)
      document.getElementById('apple-sso').addEventListener('click', async function() {
        try {
          const response = await fetch('http://localhost:8000/sso-login', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
              provider: 'Apple',
              email: 'user@example.com'
            })
          });
          
          const data = await response.json();
          
          if (data.success) {
            // Store user info in session storage
            sessionStorage.setItem('username', data.user.name);
            sessionStorage.setItem('userEmail', data.user.email);
            sessionStorage.setItem('isLoggedIn', 'true');
            
            // Redirect to API key page
            window.location.href = 'function_selection.html';
          } else {
            alert('SSO login failed: ' + data.error);
          }
        } catch (error) {
          console.error('Error during SSO login:', error);
          
          // For demo purposes: continue anyway with mock data
          sessionStorage.setItem('username', 'Demo User');
          sessionStorage.setItem('userEmail', 'demo@example.com');
          sessionStorage.setItem('isLoggedIn', 'true');
          
          // Redirect to API key page
          window.location.href = 'function_selection.html';
        }
      });
      
      // Handle traditional login
      document.getElementById('login-button').addEventListener('click', async function() {
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        
        if (!email || !password) {
          alert('Please enter both email and password');
          return;
        }
        
        try {
          // Send login request to server
          const response = await fetch('http://localhost:8000/login', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              email: email,
              password: password
            })
          });
          
          const data = await response.json();
          
          if (data.success) {
            // Store user info in session storage
            sessionStorage.setItem('username', data.user.name);
            sessionStorage.setItem('userEmail', data.user.email);
            sessionStorage.setItem('isLoggedIn', 'true');
            
            // Redirect to API key page
            window.location.href = 'function_selection.html';
          } else {
            // Login failed
            alert('Login failed: ' + data.error);
          }
        } catch (error) {
          console.error('Error during login:', error);
          
          // For demo purposes: continue anyway with mock data
          sessionStorage.setItem('username', 'Demo User');
          sessionStorage.setItem('userEmail', 'demo@example.com');
          sessionStorage.setItem('isLoggedIn', 'true');
          
          // Redirect to API key page
          window.location.href = 'function_selection.html';
        }
      });
      
      // show register page
      document.getElementById('show-register').addEventListener('click', function(e) {
          e.preventDefault();
          document.querySelector('.traditional-login').style.display = 'none';
          document.getElementById('register-form').style.display = 'block';
      });

      // back to login page
      document.getElementById('back-to-login').addEventListener('click', function() {
          document.querySelector('.traditional-login').style.display = 'block';
          document.getElementById('register-form').style.display = 'none';
      });

      // deal with register request
      document.getElementById('register-button').addEventListener('click', async function() {
          const name = document.getElementById('register-name').value;
          const email = document.getElementById('register-email').value;
          const password = document.getElementById('register-password').value;
          
          if (!email || !password) {
              alert('Please enter both email and password');
              return;
          }
          
          try {
              // Send registration request to server
              const response = await fetch('http://localhost:8000/register', {
                  method: 'POST',
                  headers: {
                      'Content-Type': 'application/json',
                  },
                  body: JSON.stringify({
                      name: name,
                      email: email,
                      password: password
                  })
              });
              
              const data = await response.json();
              
              if (data.success) {
                  // Registration successful, return to login form
                  alert('Registration successful. Please log in.');
                  document.querySelector('.traditional-login').style.display = 'block';
                  document.getElementById('register-form').style.display = 'none';
              } else {
                  // Registration failed
                  alert('Registration failed: ' + data.message);
              }
          } catch (error) {
              console.error('Error during registration:', error);
              alert('Error connecting to server. Please make sure the server is running.');
          }
      });

      // Check if user is already logged in
      document.addEventListener('DOMContentLoaded', function() {
        const isLoggedIn = sessionStorage.getItem('isLoggedIn');
        if (isLoggedIn === 'true') {
          // User is already logged in, redirect to API key page
          window.location.href = 'function_selection.html';
        }
      });
    </script>
  </body>
</html>